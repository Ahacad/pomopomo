var $=Object.defineProperty,J=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var I=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,N=(e,t)=>{for(var n in t||(t={}))q.call(t,n)&&I(e,n,t[n]);if(P)for(var n of P(t))z.call(t,n)&&I(e,n,t[n]);return e},F=(e,t)=>J(e,V(t));import{c as v,u as w,a as d,R as o,r as g,s as Y,T as K,b as W,A as E,d as U,H as G,B as Q,L as X,e as Z,f as _,P as ee}from"./vendor.167cf90c.js";const te=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};te();function oe(){const e=new Date,[t,n,a]=[e.getDate(),e.getMonth()+1,e.getFullYear()];return String(a)+"-"+String(n)+"-"+String(t)}const D=e=>t=>t[e],ne={days:{},tasks:[{id:1,name:"Task1",finishedPomodoro:0,estimationPomodoro:0},{id:2,name:"Task2",finishedPomodoro:0,estimationPomodoro:0}],finishedTasks:[],selectedTask:0,nextTaskId:3},R=v({name:"data",initialState:ne,reducers:{newclock:(e,t)=>{const n=oe();D(n)(e.days)?D(n)(e.days).push(t.payload):e.days[n]=[t.payload],t.payload.taskId&&e.tasks.forEach(a=>{a.id===t.payload.taskId&&(a.finishedPomodoro+=1)})},newTask:(e,t)=>{e.tasks.push({id:e.nextTaskId,finishedPomodoro:0,name:t.payload.name,estimationPomodoro:t.payload.estimationPomodoro}),e.nextTaskId+=1},finishTask:(e,t)=>{let n=[];for(let a=0;a<e.tasks.length;a++)if(e.tasks[a].id===t.payload){n=e.tasks.splice(a,1);break}n[0].finished=!0,e.finishedTasks.push(n[0])},unfinishTask:(e,t)=>{let n=[];for(let a=0;a<e.finishedTasks.length;a++)if(e.finishedTasks[a].id===t.payload){n=e.finishedTasks.splice(a,1);break}n[0].finished=!1,e.tasks.push(n[0])},selectTask:(e,t)=>{t.payload===0?e.selectedTask=0:e.selectedTask=t.payload},updateTask:(e,t)=>{t.payload.taskId&&e.tasks.forEach(n=>{n.id===t.payload.taskId&&(n.name=t.payload.name,n.estimationPomodoro=t.payload.estimationPomodoro)})},deleteTask:(e,t)=>{e.tasks=e.tasks.filter(n=>n.id!==t.payload)}}}),{newclock:ae,newTask:se,selectTask:L,updateTask:re,deleteTask:ie,finishTask:le,unfinishTask:ce}=R.actions;var de=R.reducer;const A=v({name:"clock",initialState:{duration:5,startTimeLeft:5,timenow:5,clockRunning:!1},reducers:{stop:e=>{e.clockRunning=!1,e.startTimeLeft=e.timenow},start:e=>{e.clockRunning=!0},decrease:(e,t)=>{e.timenow=e.startTimeLeft-t.payload},reset:e=>{e.timenow=e.duration,e.startTimeLeft=e.duration},setTimenow:(e,t)=>{e.timenow=t.payload},setDuration:(e,t)=>{typeof t.payload=="number"&&t.payload&&(e.duration=t.payload,e.timenow=e.duration,e.startTimeLeft=e.duration,e.clockRunning=!1)}}}),{stop:me,start:ue,setTimenow:Me,decrease:fe,reset:he,setDuration:x}=A.actions;var pe=A.reducer;function ke(e,t){"Notification"in window?Notification.permission==="granted"?new Notification(e,t):Notification.permission!=="denied"&&Notification.requestPermission().then(n=>{n==="granted"&&new Notification(e,t)}):console.warn("Notification not supported in this browser")}const B=v({name:"config",initialState:{pomodoroDuration:1500,shortBreakDuration:180,longBreakDuration:900,theme:"pomodoro"},reducers:{changeTheme:(e,t)=>{t.payload=="pomodoro"?e.theme="pomodoro":t.payload=="shortbreak"?e.theme="shortbreak":t.payload=="longbreak"&&(e.theme="longbreak")}}}),{changeTheme:T}=B.actions;var ge=B.reducer;function be(){const e=w(),t=d(r=>r.config.pomodoroDuration),n=d(r=>r.clock.clockRunning),a=d(r=>r.config.theme),s=d(r=>r.config.shortBreakDuration),i=d(r=>r.config.longBreakDuration);function m(){if(a==="pomodoro")return 1;if(a==="shortbreak")return 2;if(a==="longbreak")return 3}function f(r){r!==m()&&(r===1&&(!n||confirm("are you sure to switch?"))?(e(T("pomodoro")),e(x(t))):r===2&&(!n||confirm("are you sure to switch?"))?(e(T("shortbreak")),e(x(s))):r===3&&(!n||confirm("are you sure to switch?"))?(e(T("longbreak")),e(x(i))):r===4&&(!n||confirm("are you sure to switch?"))&&(e(T("pomodoro")),e(x(5))))}return o.createElement("div",null,o.createElement("button",{className:"bg-white mr-1 text-black rounded-lg p-2",onClick:()=>f(1)},"Pomodoro"),o.createElement("button",{className:"bg-white mr-1 text-black rounded-lg p-2",onClick:()=>f(2)},"Short Break"),o.createElement("button",{className:"bg-white mr-1 text-black rounded-lg p-2",onClick:()=>f(3)},"Long Break"),o.createElement("button",{className:"bg-white text-black rounded-lg p-2",onClick:()=>f(4)},"TEST"))}function ye(){Notification.requestPermission();const e=w(),t=d(l=>l.clock.timenow),n=d(l=>l.clock.duration),a=d(l=>l.clock.clockRunning),s=d(l=>l.data.selectedTask),i=d(l=>l.config.theme),[m,f]=g.exports.useState(""),[r,b]=g.exports.useState("");function y(){t===n&&b(new Date().toString()),f(new Date().toString()),e(ue())}function p(){e(me())}async function u(l){let h=new Date().toString();ke("pomodoro finished!"),e(he()),p(),i==="pomodoro"&&l&&e(ae({startTime:r,endTime:h,duration:n,taskId:s}))}g.exports.useEffect(()=>{const l=setInterval(()=>{if(!a)return;if(t<=0){u(!0);return}const h=new Date;let H=Math.floor((h.getTime()-new Date(m).getTime())/1e3);e(fe(H))},1e3);return()=>{clearInterval(l)}});function k(l){l=Math.ceil(l);const h=String(Math.floor(l/60));return h.length==1?"0"+h:h}function C(l){l=Math.ceil(l);const h=String(l-60*Math.floor(l/60));return h.length==1?"0"+h:h}function j(){window.confirm("Are you sure to skip this clock? (This one won't be counted as pomodoro in the report)")&&u(!0)}return document.title=`pomopomo ${k(t)} : ${C(t)}`,o.createElement("div",{className:""},o.createElement(be,null),o.createElement("div",null,k(t)," : ",C(t)),o.createElement("button",{className:"bg-white text-black mr-2 p-2 rounded-lg",onClick:a?p:y},a?"pause":"start"),o.createElement("button",{className:"bg-white text-black mr-2 p-2 rounded-lg",onClick:j},"jump"))}function we({clickHandler:e}){function t(n){n.stopPropagation(),e()}return o.createElement("button",{className:"border-2 hover:bg-gray-300 w-10 pt-1 ml-2 pl-1",onClick:t},o.createElement(Q,{className:""}))}function Ee({taskData:e,cancelHandler:t,deleteHandler:n}){const a=w(),[s,i]=g.exports.useState(e.name),[m,f]=g.exports.useState(e.estimationPomodoro),r=k=>{i(k.target.value)},b=k=>{f(parseInt(k.target.value,10))},y=k=>{k.stopPropagation(),t()},p=k=>{n()},u=k=>{a(re({taskId:e.id,name:s,estimationPomodoro:m}))};return o.createElement("div",{className:"w-full"},o.createElement("form",{className:"bg-white shadow-md rounded-md px-8 pt-6 pb-8 mb-4"},o.createElement("div",{className:"mb-4"},o.createElement("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"task"},"Task Name"),o.createElement("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-sm",id:"task",type:"text",value:s,onChange:r})),o.createElement("div",{className:"mb-6"},o.createElement("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"estimation"},"Estimate Round"),o.createElement("input",{className:"shadow appearance-none border border rounded w-3/12 py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline text-sm ",id:"estimation",type:"number",value:m||"",onChange:b})),o.createElement("div",{className:"flex items-center justify-between"},o.createElement("button",{className:"text-white bg-red-700 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm",type:"button",onClick:p},"Delete"),o.createElement("button",{className:"text-gray-400 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm",type:"button",onClick:y},"Cancel"),o.createElement("button",{className:"bg-gray-700 hover:bg-black text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm",type:"button",onClick:u},"Save"))))}function M({taskData:e}){const t=w(),n=d(p=>p.data.selectedTask),[a,s]=g.exports.useState(!1);function i(){n===e.id?t(L(0)):t(L(e.id))}function m(){return n===e.id?"border-indigo-400 transform translate-y-0.5":""}function f(){s(!a)}function r(){f()}function b(){window.confirm("are you sure to delete this task?")&&t(ie(e.id))}function y(p){p.stopPropagation(),e.finished?t(ce(e.id)):t(le(e.id))}return o.createElement(o.Fragment,null,o.createElement("button",{onClick:i,className:`bg-white w-full text-black flex justify-between p-4 mb-2 rounded-md border-l-8 hover:border-indigo-400 transform ${m()}`},o.createElement("div",{className:"flex"},o.createElement(U,{className:"mt-2 mr-1 hover:text-gray-400",onClick:y}),e.name),o.createElement("div",{className:"flex"},e.finishedPomodoro," /"," ",e.estimationPomodoro?e.estimationPomodoro:0,o.createElement(we,{clickHandler:f}))),o.createElement(E,{show:a},o.createElement(Ee,{taskData:e,cancelHandler:r,deleteHandler:b})))}function xe(){const e=w(),[t,n]=g.exports.useState(!0),[a,s]=g.exports.useState(""),[i,m]=g.exports.useState(1),f=u=>{u.stopPropagation(),n(!1)},r=u=>{u.stopPropagation(),n(!0)},b=u=>{u.stopPropagation(),s(u.target.value)},y=u=>{m(parseInt(u.target.value,10))},p=u=>{if(a===""){alert("task name cannot be empty!");return}e(se({name:a,estimationPomodoro:i})),s(""),m(0)};return o.createElement(o.Fragment,null,o.createElement(E,{show:t},o.createElement("div",{className:"h-12 bg-black opacity-10 hover:opacity-20 py-1 rounded-md cursor-pointer",onClick:f},o.createElement("div",{className:"relative top-1/2 transform -translate-y-1/2 text-base text-white flex justify-center"},o.createElement("div",{className:"flex"},o.createElement(G,{className:"mt-1 mr-2"})," Add Task")))),o.createElement(E,{show:!t},o.createElement("div",{className:"w-full"},o.createElement("form",{className:"bg-white shadow-md rounded-md px-8 pt-6 pb-8 mb-4"},o.createElement("div",{className:"mb-4"},o.createElement("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"task"},"New Task"),o.createElement("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-sm",id:"task",type:"text",value:a,onChange:b})),o.createElement("div",{className:"mb-6"},o.createElement("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"estimation"},"Estimate Round"),o.createElement("input",{className:"shadow appearance-none border border rounded w-3/12 py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline text-sm ",id:"estimation",type:"number",value:i||"",onChange:y})),o.createElement("div",{className:"flex items-center justify-between"},o.createElement("div",null),o.createElement("button",{className:"text-gray-400 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm",type:"button",onClick:r},"Cancel"),o.createElement("button",{className:"bg-gray-700 hover:bg-black text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm",onClick:p,type:"button"},"Add"))))))}const O=Y(e=>o.createElement(K,N({},e)))(({theme:e})=>({color:"white"}));function Te(){const e=d(t=>t.data.tasks);return o.createElement(o.Fragment,null,e.map(t=>o.createElement(M,{key:t.id,taskData:t})),o.createElement(xe,null))}function Ne(){const e=d(t=>t.data.finishedTasks);return o.createElement(o.Fragment,null,e.map(t=>o.createElement(M,{key:t.id,taskData:t})))}function ve(){const[e,t]=g.exports.useState(0),n=(a,s)=>{t(s)};return o.createElement("div",{className:""},o.createElement("div",{className:"w-96 mt-10"},o.createElement(W,{value:e,centered:!0,onChange:n},o.createElement(O,{label:"Tasks"}),o.createElement(O,{label:"Finished"})),o.createElement(E,{show:e===0},o.createElement(Te,null)),o.createElement(E,{show:e===1},o.createElement(Ne,null))))}function Se(){const e=d(a=>a.data.days),t=new Map;for(const a in e)t.set(a,e[a].length);const n=[];return t.forEach((a,s)=>{n.push({x:s,y:a})}),n}const Ce={width:900,height:400,margin:{top:20,right:20,bottom:60,left:80},animate:!0,enableSlices:"x"};function Pe(){const e=Se();return o.createElement(X,F(N({},Ce),{data:[{id:"daily",data:e}],xScale:{type:"time",format:"%Y-%m-%d",useUTC:!1,precision:"day"},xFormat:"time:%Y-%m-%d",yScale:{type:"linear",stacked:!0,min:0,max:"auto"},axisLeft:{legend:"pomo",legendOffset:-40,legendPosition:"middle"},axisBottom:{format:"%b %d",tickValues:"every 1 day",tickRotation:30,legend:"day",legendOffset:-12},enablePointLabel:!0,pointSize:16,pointBorderWidth:1,pointBorderColor:{from:"color",modifiers:[["darker",.3]]},useMesh:!0,enableSlices:!1}))}async function Ie(e,t){let n;n=await window.showSaveFilePicker(t);const a=await n.createWritable();await a.write(e),await a.close()}async function Fe(e){await Ie(e,{types:[{description:"Json data",accept:{"application/json":[".json"]}}]})}function De(){const e=d(s=>s.config.theme),t=d(s=>s);Notification.permission!=="granted"&&Notification.requestPermission();function n(){return e==="pomodoro"?"#db524d":e==="shortbreak"?"#468e91":e==="longbreak"?"#437ea8":"#db524d"}const a=async()=>{await Fe(JSON.stringify(t))};return o.createElement("div",{className:"App"},o.createElement("div",{className:"App-header",style:{backgroundColor:n()}},o.createElement("div",{className:"flex justify-between w-full"},o.createElement("div",null),o.createElement("button",{className:"bg-white text-sm text-black mr-2 rounded p-1",onClick:a},"Download Data")),o.createElement(ye,null),o.createElement(ve,null)),o.createElement("div",{className:"flex justify-center w-full"},o.createElement(Pe,null)))}const Re=()=>{try{const e=localStorage.getItem("state");return e?JSON.parse(e):void 0}catch{return}},Le=e=>{try{const t=JSON.stringify(e);localStorage.setItem("state",t)}catch(t){console.log(t)}},c=Re();if(c!=null){c.clock.clockRunning=!1,c.data.finishedTasks===void 0&&(c.data.finishedTasks=[]);for(const e of c.data.tasks)e.finished=!1;for(const e of c.data.finishedTasks)e.finished=!0;if(c.data.nextTaskId===void 0){c.data.nextTaskId=0;for(const e of c.data.tasks)c.data.nextTaskId=Math.max(c.data.nextTaskId,e.id);for(const e of c.data.finishedTasks)c.data.nextTaskId=Math.max(c.data.nextTaskId,e.id);c.data.nextTaskId+=1}}console.log(c);const S=Z({reducer:{data:de,clock:pe,config:ge},preloadedState:c});S.subscribe(()=>{Le(S.getState())});_.render(o.createElement(o.StrictMode,null,o.createElement(ee,{store:S},o.createElement(De,null))),document.getElementById("root"));
